diff --git a/CMakeLists.txt b/CMakeLists.txt
index cc3ef140..511f5cb9 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -419,8 +419,10 @@ list(REMOVE_ITEM __tmp_srcs ${onnx_gtests_src})
 list(APPEND ONNX_SRCS ${__tmp_srcs})
 
 # Hide all symbols we don't need
-set_target_properties(onnx_proto PROPERTIES CXX_VISIBILITY_PRESET hidden)
-set_target_properties(onnx_proto PROPERTIES VISIBILITY_INLINES_HIDDEN 1)
+if(NOT BUILD_SHARED_LIBS)
+  set_target_properties(onnx_proto PROPERTIES CXX_VISIBILITY_PRESET hidden)
+  set_target_properties(onnx_proto PROPERTIES VISIBILITY_INLINES_HIDDEN 1)
+endif()
 
 set(LINKED_PROTOBUF_TARGET protobuf::libprotobuf)
 if(ONNX_USE_LITE_PROTO)
@@ -459,8 +461,10 @@ if(CMAKE_SYSTEM_NAME STREQUAL "AIX")
 else()
   add_library(onnx ${ONNX_SRCS})
 endif()
-set_target_properties(onnx PROPERTIES CXX_VISIBILITY_PRESET hidden)
-set_target_properties(onnx PROPERTIES VISIBILITY_INLINES_HIDDEN ON)
+if(NOT BUILD_SHARED_LIBS)
+  set_target_properties(onnx PROPERTIES CXX_VISIBILITY_PRESET hidden)
+  set_target_properties(onnx PROPERTIES VISIBILITY_INLINES_HIDDEN ON)
+endif()
 
 target_link_libraries(onnx PUBLIC onnx_proto)
 add_onnx_global_defines(onnx)
